# 动态代理

动态代理：是使用反射和字节码的技术，在运行期创建指定接口或类的子类（动态代理）以及其实例对象的技术，通过这个技术可以无侵入性的为代理进行增强

### 实现的两种方式

1. JDK原生动态代理
2. CGLB动态代理

### JDK原生动态代理

Proxy：Proxy是所有动态代理的父类，它提供一个静态方法(new ProxyInstance())来创建动态代理的class对象和实例；

InvocationHandler：每个动态代理实例都有一个关联的InvocationHandler。在代理实例上调用方法时，方法调用被转发到InvocationHandler的invoke方法；

### CGLIB动态代理

CGLIB（Code Generation Library）是一个基于ASM的字节码生成库，它允许我们在运行时对字节码进行修改和动态生成。CGLIB通过集成方式实现代理；

Enhancer：来指定要代理的目标对象、实际处理代理逻辑的对象，最终通过调用create()方法得到代理对象，对这个对象所有非final方法的调用都会转发给MethodInterceptor；

MethodInterceptor：动态代理对象的方法都会转发到intercept方法进行增强；



> JDK原生动态代理是Java原生支持的，不需要任何外部依赖，但是他只能基于接口进行代理
>
> CGLIB通过继承的方式进行代理，无论目标对象有没有实现接口都可以代理，但是无法处理final的情况

13、Spring的两种代理JDK和CGLIB的区别浅谈？

Java动态代理是利用反射机制生成一个实现代理接口的匿名类，在调用具体方法前调用InvokeHandler来处理。而cglib动态代理是利用asm开源包，对代理对象类的class文件加载进来，通过修改其字节码生成子类来处理。

- 如果目标对象实现了接口，默认情况下会采用JDK的动态代理实现AOP，或者强制使用CGLIB实现AOP。
- 如果目标对象没有实现了接口，必须采用CGLIB库，Spring会自动在JDK动态代理和CGLIB之间转换。

